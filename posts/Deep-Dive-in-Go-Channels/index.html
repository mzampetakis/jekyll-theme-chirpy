<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Deep Dive in Go Channels" /><meta property="og:locale" content="en_US" /><meta name="description" content="A brief deep dive in Go Channels with examples and common error cases." /><meta property="og:description" content="A brief deep dive in Go Channels with examples and common error cases." /><link rel="canonical" href="https://mzampetakis.com/posts/Deep-Dive-in-Go-Channels/" /><meta property="og:url" content="https://mzampetakis.com/posts/Deep-Dive-in-Go-Channels/" /><meta property="og:site_name" content="Michalis Zampetakis" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-10-31T07:55:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Deep Dive in Go Channels" /><meta name="twitter:site" content="@mzampetakis" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"A brief deep dive in Go Channels with examples and common error cases.","url":"https://mzampetakis.com/posts/Deep-Dive-in-Go-Channels/","@type":"BlogPosting","headline":"Deep Dive in Go Channels","dateModified":"2021-07-01T22:16:00+03:00","datePublished":"2020-10-31T07:55:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mzampetakis.com/posts/Deep-Dive-in-Go-Channels/"},"@context":"https://schema.org"}</script><title>Deep Dive in Go Channels | Michalis Zampetakis</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Michalis Zampetakis"><meta name="application-name" content="Michalis Zampetakis"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-172730569-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-172730569-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/mz2.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Michalis Zampetakis</a></div><div class="site-subtitle font-italic">Curiosity Driven</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/now/" class="nav-link"> <i class="fa-fw fas fa-clock ml-xl-3 mr-xl-3 unloaded"></i> <span>NOW</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/mzampetakis" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/mzampetakis" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mzampetakis','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Deep Dive in Go Channels</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Deep Dive in Go Channels</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Michalis Zampetakis </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Oct 31, 2020, 7:55 AM +0200" prep="on" > Oct 31, 2020 <i class="unloaded">2020-10-31T07:55:00+02:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 1, 2021, 10:16 PM +0300" prefix="Updated " > Jul 1 <i class="unloaded">2021-07-01T22:16:00+03:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1298 words">7 min</span></div></div><div class="post-content"><p>One of the biggest advantages of Go is undoubtedly it’s concurrency management. Goroutines are the main feature that Go uses to achieve this. Goroutines wouldn’t be so easy if there wasn’t for channels.</p><blockquote><p>A goroutine is a lightweight thread managed by the Go runtime.</p></blockquote><p>Channels are the pipes that connect concurrent goroutines. You can send values into channels from one goroutine and receive those values into another goroutine.</p><h2 id="how-channels-work">How channels work</h2><p>Go provides a simple and straightforward mechanism to manage channels that allows goroutines to send and receive values from other gorourtines.</p><p>A new channel can be created by invoking the make command like this <code class="language-plaintext highlighter-rouge">make(chan value-type)</code>. value-type is the type of values that the generated channel will hold and transfer.</p><p>Sending a value through a channel can be done by <code class="language-plaintext highlighter-rouge">a-channel &lt;- a-value</code>. Receiving a value from a channel can be done by <code class="language-plaintext highlighter-rouge">a-value := &lt;- a-channel</code>.</p><p>The following example illustrates a simple scenario where a goroutine send a value to a channel while</p><div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">messages</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">)</span>
	<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span> <span class="o">*</span> <span class="m">5</span><span class="p">)</span>
		<span class="n">messages</span> <span class="o">&lt;-</span> <span class="s">"ping"</span>
	<span class="p">}()</span>
	<span class="n">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">messages</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In our example, the main functions create a channel of type string and the spawned goroutine waits for 5” before sending a “ping” message through this channel. Main function blocks at receiving data from the channel at line 14 until the data is received and then prints the received data (“ping”) and exits.</p><h2 id="buffered-and-unbuffered-channels">Buffered and unbuffered channels</h2><p>The example we saw exploited the functionality of an unbuffered channel. The size of the channel was <code class="language-plaintext highlighter-rouge">0</code> which shows the capacity of a channel. For an unbuffered channel, we can only send data if there is a corresponding receive statement - otherwise, it blocks.</p><p>To illustrate this example we can see that running the following example, <code class="language-plaintext highlighter-rouge">pong</code> message can be sent after 5” when the 2nd receive is initiated.</p><div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">messages</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">)</span>
	<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="n">messages</span> <span class="o">&lt;-</span> <span class="s">"ping"</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"ping sent"</span><span class="p">)</span>
		<span class="n">messages</span> <span class="o">&lt;-</span> <span class="s">"pong"</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"pong sent"</span><span class="p">)</span>
	<span class="p">}()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="n">messages</span><span class="p">)</span>
	<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span> <span class="o">*</span> <span class="m">5</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="n">messages</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The output we get from this example is:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>&gt;/ go run main.go
ping sent
ping
# here we have a 5" pause
pong
pong sent
</pre></table></code></div></div><p>We can see that send is blocked until the recipient is present.</p><p>Let’s see now buffered channels in go. A buffered channel in go accepts a limited number of values without a corresponding receiver for those values. A buffered channel is created also by calling <code class="language-plaintext highlighter-rouge">make</code> but now an extra argument has to be provided that indicates the buffer size of the channel <code class="language-plaintext highlighter-rouge">make(chan value-type, buffer-size)</code>.</p><p>Changing in the previous example the channel construction line to <code class="language-plaintext highlighter-rouge">messages := make(chan string, 2)</code> will produce the following output:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>/&gt; go run main.go
ping sent
pong sent
ping
# here we have a 5" pause
pong
</pre></table></code></div></div><h2 id="bidirectional-channels">Bidirectional channels</h2><p>We have seen that the same channel is used to send and receive data. However, when passing a channel to a function we can specify if the function is going to send or receive message(s) from the channel. This feature increases the type-safety of the program.</p><p>The way of defining this feature is at the functions header. A sender only function will be:</p><div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">sender</span><span class="p">(</span><span class="n">messages</span> <span class="k">chan</span><span class="o">&lt;-</span> <span class="kt">string</span><span class="p">)</span>
</pre></table></code></div></div><p>a receiver only function will be:</p><div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="n">receiver</span><span class="p">(</span><span class="n">messages</span> <span class="o">&lt;-</span><span class="k">chan</span> <span class="kt">string</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="closing-a-channel">Closing a channel</h2><p>Closing a channel signifies that no more data will be sent through this. This is a really useful feature that is used to inform receivers that channel’s sending has been completed.</p><p>Closing a channel can be done through <code class="language-plaintext highlighter-rouge">close(messages)</code> and while receiving we have to check if the channel has closed. To do so we can add one more return value to the receiver of our channel:</p><div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">message</span><span class="p">,</span> <span class="n">more</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">messages</span>
<span class="k">if</span> <span class="n">more</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"received message"</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"received all messages"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="a-real-world-scenario">A real-world scenario</h2><p>In a more real-word scenario now let’s examine three two goroutines should handle sending and receiving data as a sequential process.</p><p>Let’s assume we need 3 services that serially process data. The first one generates numbers (<code class="language-plaintext highlighter-rouge">Counter</code>) the second one doubles them (<code class="language-plaintext highlighter-rouge">Doubler</code>) and the last one prints the result (<code class="language-plaintext highlighter-rouge">Printer</code>). This is presented in the following schema:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>+---------------+            +---------------+            +---------------+
|               |   1,2,3    |               |   2,4,6    |               |
|    Counter    |+----------&gt;|    Doubler    |+----------&gt;|    Printer    |
|               |  numbers   |               |  doubles   |               |
+---------------+            +---------------+            +---------------+
</pre></table></code></div></div><p>All data exchange between goroutines should be explicitly done through different channels. Each goroutine should only send or receive to/from each channel.</p><div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"os"</span>
	<span class="s">"os/signal"</span>
	<span class="s">"sync"</span>
	<span class="s">"syscall"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">numbers</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">int</span><span class="p">)</span>
	<span class="n">doubles</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">int</span><span class="p">)</span>
	<span class="k">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>

	<span class="n">sigs</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="n">os</span><span class="o">.</span><span class="n">Signal</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
	<span class="n">signal</span><span class="o">.</span><span class="n">Notify</span><span class="p">(</span><span class="n">sigs</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">syscall</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">)</span>
	<span class="n">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">bool</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
	<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="n">sig</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">sigs</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">()</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
		<span class="n">done</span> <span class="o">&lt;-</span> <span class="no">true</span>
	<span class="p">}()</span>
	
	<span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
	<span class="k">go</span> <span class="n">counter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wg</span><span class="p">,</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span>
	<span class="k">go</span> <span class="n">doubler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wg</span><span class="p">,</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">doubles</span><span class="p">)</span>
	<span class="k">go</span> <span class="n">printer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wg</span><span class="p">,</span> <span class="n">doubles</span><span class="p">)</span>
	<span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">counter</span><span class="p">(</span><span class="n">wg</span> <span class="o">*</span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span><span class="p">,</span> <span class="n">numbers</span> <span class="k">chan</span><span class="o">&lt;-</span> <span class="kt">int</span><span class="p">,</span> <span class="n">done</span> <span class="o">&lt;-</span><span class="k">chan</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
	<span class="n">totalSent</span> <span class="o">:=</span> <span class="m">0</span>
	<span class="k">for</span> <span class="n">x</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">x</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">numbers</span> <span class="o">&lt;-</span> <span class="n">x</span>
		<span class="n">totalSent</span><span class="o">++</span>
		<span class="k">select</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">_</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">done</span><span class="o">:</span>
			<span class="k">if</span> <span class="n">ok</span> <span class="p">{</span>
				<span class="nb">close</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
				<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Closing numbers. Total Sent: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">totalSent</span><span class="p">)</span>
				<span class="k">return</span>
			<span class="p">}</span>
		<span class="k">default</span><span class="o">:</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">doubler</span><span class="p">(</span><span class="n">wg</span> <span class="o">*</span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span><span class="p">,</span> <span class="n">numbers</span> <span class="o">&lt;-</span><span class="k">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="n">doubles</span> <span class="k">chan</span><span class="o">&lt;-</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
	<span class="k">for</span> <span class="p">{</span>
		<span class="n">x</span><span class="p">,</span> <span class="n">more</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">numbers</span>
		<span class="k">if</span> <span class="o">!</span><span class="n">more</span> <span class="p">{</span>
			<span class="nb">close</span><span class="p">(</span><span class="n">doubles</span><span class="p">)</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Closing doubles"</span><span class="p">)</span>
			<span class="k">return</span>
		<span class="p">}</span>
		<span class="n">doubles</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">printer</span><span class="p">(</span><span class="n">wg</span> <span class="o">*</span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span><span class="p">,</span> <span class="n">doubles</span> <span class="o">&lt;-</span><span class="k">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
	<span class="n">totalReceived</span> <span class="o">:=</span> <span class="m">0</span>
	<span class="k">for</span> <span class="p">{</span>
		<span class="n">d</span><span class="p">,</span> <span class="n">more</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">doubles</span>
		<span class="k">if</span> <span class="o">!</span><span class="n">more</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Closing Printer. Total Received %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">totalReceived</span><span class="p">)</span>
			<span class="k">return</span>
		<span class="p">}</span>
		<span class="n">totalReceived</span><span class="o">++</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We can see that all goroutines either consume or produce data to each given channel. <code class="language-plaintext highlighter-rouge">counter()</code> just sends to <code class="language-plaintext highlighter-rouge">numbers</code> channel, <code class="language-plaintext highlighter-rouge">doubler()</code> receives from <code class="language-plaintext highlighter-rouge">numbers</code> and sends to <code class="language-plaintext highlighter-rouge">doubles</code> and <code class="language-plaintext highlighter-rouge">printer()</code> just receives from <code class="language-plaintext highlighter-rouge">doubler</code> channel.</p><p>A <code class="language-plaintext highlighter-rouge">sync.WaitGroup</code> is used to allow our main function to wait for all three goroutines to end before exiting. This allows all threads to gracefully finish their jobs</p><p>Lines 14 to 23 are used to exit our application and gorourines. When a <code class="language-plaintext highlighter-rouge">SIGINT</code> or <code class="language-plaintext highlighter-rouge">SIGTERM</code> signals are received a special (for our application!) channel named <code class="language-plaintext highlighter-rouge">done</code> is used to signal the <code class="language-plaintext highlighter-rouge">counter()</code> function that it should stop producing new numbers. Closing the <code class="language-plaintext highlighter-rouge">numbers</code> allows us in the <code class="language-plaintext highlighter-rouge">doubler()</code> function to close the <code class="language-plaintext highlighter-rouge">doubles</code> channel as soon as all numbers have been processed. Then <code class="language-plaintext highlighter-rouge">printer()</code> can print all doubles and return.</p><h2 id="sum-up">Sum Up</h2><p>We have seen some basic concepts of channels in go. Channels allow our goroutines to exchange data in a thread-safe way. Lots of options are provided to meet an application’s need. We’ve seen how to create channels. the difference between buffered and unbuffered channels, how to close a channel, and how to perceive that a channel has closed!</p><p>Channels are widely used in go apps especially when exploiting go’s concurrency mechanisms. Hope that this post will give you a better understanding of channels in go.</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/golang/" class="post-tag no-text-decoration" >golang</a> <a href="/tags/coding/" class="post-tag no-text-decoration" >coding</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Deep Dive in Go Channels - Michalis Zampetakis&url=https://mzampetakis.com/posts/Deep-Dive-in-Go-Channels/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Deep Dive in Go Channels - Michalis Zampetakis&u=https://mzampetakis.com/posts/Deep-Dive-in-Go-Channels/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Deep Dive in Go Channels - Michalis Zampetakis&url=https://mzampetakis.com/posts/Deep-Dive-in-Go-Channels/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Hello-Blog/">Hello Blog</a><li><a href="/posts/Log-Requests-in-Go/">Log Requests in Go</a><li><a href="/posts/AquaGo-A-Toy-Project/">AquaGo - A Toy Project</a><li><a href="/posts/Testing-When-Time-Matters/">Testing When Time Matters</a><li><a href="/posts/Deep-Dive-in-Go-Channels/">Deep Dive in Go Channels</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/blogging/">blogging</a> <a class="post-tag" href="/tags/image-processing/">image-processing</a> <a class="post-tag" href="/tags/lego/">LEGO</a> <a class="post-tag" href="/tags/oauth/">oAuth</a> <a class="post-tag" href="/tags/shell/">shell</a> <a class="post-tag" href="/tags/testing/">testing</a> <a class="post-tag" href="/tags/time/">time</a> <a class="post-tag" href="/tags/toy-project/">toy-project</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Log-Requests-in-Go/"><div class="card-body"> <span class="timeago small" > Aug 17, 2020 <i class="unloaded">2020-08-17T23:40:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Log Requests in Go</h3><div class="text-muted small"><p> It’s a common sense that logging your HTTP request in your application is essential. The reasons for doing so are numerous. Error reporting, tracing, monitoring, performance tuning and so on. One ...</p></div></div></a></div><div class="card"> <a href="/posts/AquaGo-A-Toy-Project/"><div class="card-body"> <span class="timeago small" > Aug 31, 2020 <i class="unloaded">2020-08-31T22:40:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AquaGo - A Toy Project</h3><div class="text-muted small"><p> Just imagine if you could have on your living’s room TV an aquarium! Wouldn’t that be nice, especially during the hot period of summertime? What about if you could add digital fishes and decorative...</p></div></div></a></div><div class="card"> <a href="/posts/Exec-Command/"><div class="card-body"> <span class="timeago small" > May 6 <i class="unloaded">2021-05-06T19:40:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Exec.Command</h3><div class="text-muted small"><p> One of the key features of Go is the considerably rich standard library. Go’s os package offers a wide range of methods and functions to allow programmers to exploit the host’s OS capabilities. U...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Testing-When-Time-Matters/" class="btn btn-outline-primary" prompt="Older"><p>Testing When Time Matters</p></a> <a href="/posts/Exec-Command/" class="btn btn-outline-primary" prompt="Newer"><p>Exec.Command</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//mzampetakis.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Deep Dive in Go Channels'; this.page.url = 'https://mzampetakis.com/posts/Deep-Dive-in-Go-Channels/'; this.page.identifier = '/posts/Deep-Dive-in-Go-Channels/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://mzampetakis.com">Michalis Zampetakis</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/blogging/">blogging</a> <a class="post-tag" href="/tags/image-processing/">image processing</a> <a class="post-tag" href="/tags/lego/">LEGO</a> <a class="post-tag" href="/tags/oauth/">oAuth</a> <a class="post-tag" href="/tags/shell/">shell</a> <a class="post-tag" href="/tags/testing/">testing</a> <a class="post-tag" href="/tags/time/">time</a> <a class="post-tag" href="/tags/toy-project/">toy project</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://mzampetakis.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
